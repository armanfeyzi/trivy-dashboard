# Trivy Dashboard Helm Values
# Configure your deployment here

# Cluster name for the exporter (required for multi-cluster setups)
# Each cluster should have a unique name
clusterName: "my-cluster"

# Namespace configuration
namespace:
  create: true
  name: trivy-dashboard

# Server Mode: "distributed" (default) or "standalone"
# standalone: Exporter runs as sidecar, sharing volume with dashboard (No S3 sync needed)
# distributed: Exporter runs separately, syncing via S3
server:
  mode: "standalone"

# Persistence for standalone mode
persistence:
  enabled: true
  storageClass: "" # default
  size: 1Gi
  accessMode: ReadWriteOnce

# Dashboard configuration
dashboard:
  enabled: true
  replicaCount: 1
  image:
    repository: armanfeyzi/trivy-dashboard
    tag: "v1.3.5"
    pullPolicy: IfNotPresent
  resources:
    requests:
      cpu: 50m
      memory: 64Mi
    limits:
      cpu: 200m
      memory: 256Mi
  # List of ALL clusters to display in the dashboard.
  # This list MUST match the 'clusterName' configured in the exporter of each cluster.
  # Example: ["dev", "PRODUCTION", "staging"]
  # The dashboard will try to fetch reports for each of these clusters.
  clusters:
    - dev
    - prod
  service:
    type: ClusterIP
    port: 80

# Exporter configuration
exporter:
  enabled: true
  replicaCount: 1
  image:
    repository: armanfeyzi/trivy-exporter
    tag: "v0.7.3"
    pullPolicy: IfNotPresent
  # Sync interval in seconds
  syncInterval: 300
  resources:
    requests:
      cpu: 50m
      memory: 64Mi
    limits:
      cpu: 200m
      memory: 256Mi

# S3 configuration for storing/reading reports
s3:
  bucket: ""           # Required: your S3 bucket name
  region: "eu-west-1"  # AWS region
  prefix: "trivy-reports"  # Optional prefix

  # AWS credentials (use IAM roles in production when possible)
  # These can also be provided via existingSecret
  accessKeyId: ""
  secretAccessKey: ""

  # Use existing secret instead of creating one
  # Secret must have keys: S3_BUCKET, AWS_REGION, S3_PREFIX, AWS_ACCESS_KEY_ID, AWS_SECRET_ACCESS_KEY
  existingSecret: ""

# Ingress configuration
ingress:
  enabled: false
  className: nginx
  annotations: {}
    # nginx.ingress.kubernetes.io/ssl-redirect: "true"
    # cert-manager.io/cluster-issuer: "letsencrypt-prod"
  hosts:
    - host: trivy.example.com
      paths:
        - path: /
          pathType: Prefix
  tls: []
    # - secretName: trivy-dashboard-tls
    #   hosts:
    #     - trivy.example.com

# Pod security context
podSecurityContext:
  runAsNonRoot: true

# Image pull secrets (if using private registry)
imagePullSecrets: []
